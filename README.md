## dunger

Единый веб-сервис для подготовки к игре Dungeon & Dragons, который интегрирует все необходимые инструменты и ресурсы для гейм-мастеров и игроков

Общие технические материалы по проекту собраны в папке [`docs`](docs),
в том числе там находится (относительно) актуальная Postman-коллекция и схема сущностей.

Клиентская часть проекта (фронтэнд системы) включает в себя веб-приложение:

- [`dunger-user-web`](packages/frontend/dunger-user-web) (`uw:`) – веб-приложение на React (Vite), интерфейс для игроков и гейм-мастеров

Общий для всех веб-приложений код вынесен во внутренние библиотеки:

- [`@dunger/auth-fetch`](packages/frontend/lib/auth-fetch) (`af:`) – React-провайдер всего необходимого для авторизации и запросов к API
- [`@dunger/ui`](packages/frontend/lib/ui) (`ui:`) – UI-кит проекта, общие для веб-приложений стили, компоненты и утилиты
- [`@dunger/eslint-plugin-import-paths`](packages/frontend/lib/eslint-plugin-import-paths) (`ip:`) – плагин для ESLint, правильно исправляет импорты на абсолютные и относительные

Детальную информацию по конкретным пакетам ищите в их собственных `README.md`.

## Релизы

Основная (и единственная долгоживущая) ветка – **master** – самый актуальный (принятый) код.

От main создаются релиз-ветки – **release\_\$ver** (например, `release_1.0` – $ver всегда состоит из двух чисел).
Сам факт появления такой ветки означает создание готового к тестированию релиз-кандидата.
Все предыдущие могут быть спокойно удалены в любой момент.

Когда (и если) тестирование релиз-кандидата прошло успешно,
от релиз-ветки создается тег с соответствующим ей названием (с префиксом **tag-**) – `tag-release_1.0`.
Появление тега является триггером к автоматическому созданию релиза –
message тега становится основой для его описания (release notes).

## Разработка

Здесь используются (и уже настроены) современная версия [Yarn 2+](https://yarnpkg.com/getting-started/migration) и [Yarn Workspaces](https://yarnpkg.com/features/workspaces) –
достаточно один раз выполнить команду **`yarn install`** из корня репозитория,
чтобы установить зависимости сразу для всех входящих в него JS-пакетов, используя один общий `yarn.lock`.

Главы в этот раздел добавляются исходя из потребностей (и запросов!) разработчиков –
обязательно сообщите, если здесь не хватает какой-либо информации.

### Окружение

Для упрощения локальной работы с внешними зависимостями в папке `_docker` лежит файл `docker-compose.yml`.
Достаточно выполнить там команду **`docker-compose up -d`**
для автоматической установки и запуска всех необходимых инструментов в формате Docker-контейнеров.

### Команды

Yarn позволяет контролировать отдельные пакеты (workspaces) прямо из корня моно-репозитория.
Например, можно использовать команду **`yarn workspace dunger-user-web dev`**
(или даже просто **`yarn uw:dev`** – см. [Yarn Global Scripts](https://yarnpkg.com/features/workspaces#global-scripts))
для запуска конкретного сервиса.

## Инфраструктура

Требуются **PostgreSQL**, **MinIO** (или любое другое S3-совместимое хранилище).

### `danger-user-web`

- Собранное в статику веб-приложение
- Не требует никаких внешних зависимостей
- Ожидает найти себя на корне отдельного домена и само контролирует роутинг
- Отправляет запросы к `backend_name` на `/api`
